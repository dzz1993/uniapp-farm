(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/market-pay/market-pay"],{"02ea":function(o,i,t){},"0965":function(o,i,t){"use strict";t.r(i);var e=t("8ba7"),n=t.n(e);for(var s in e)"default"!==s&&function(o){t.d(i,o,function(){return e[o]})}(s);i["default"]=n.a},5171:function(o,i,t){"use strict";var e=t("02ea"),n=t.n(e);n.a},"8ba7":function(o,i,t){"use strict";(function(o,t){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var e={data:function(){return{orderInfo:"",use_user_money:1,disable_ticket:0,disable_freight:0,coupon_info:"",freight_coupon_info:"",is_paymember:1,shop_goods_num:1,input_content:"",count_order_info:"",address_info:"",order_goods_info:"",order_id:""}},onLoad:function(o){var i=o.orderInfo;if(i){i=JSON.parse(i);this.orderInfo=i,this.shop_goods_num=i.shop_goods_num}this.calc_order_amount()},methods:{calc_order_amount:function(){var i=this,t={user_id:this.globalData.user_info.userid,goods_id:this.orderInfo.goods_id,goods_num:this.orderInfo.shop_goods_num};this.use_user_money&&(t.use_user_money=this.use_user_money),1==this.disable_ticket?t.disable_ticket=this.disable_ticket:this.coupon_info?(t.disable_ticket=0,t.ticket_id=this.coupon_info.id):t.disable_ticket=0,1==this.disable_freight?t.disable_freight=this.disable_freight:this.freight_coupon_info?(t.disable_freight=0,t.user_freight_id=this.freight_coupon_info.id):t.disable_freight=0,this.address_info&&this.address_info.id&&(t.address_id=this.address_info.id),this.xm_config.calc_order_amount(t).then(function(t){1==t.data.status?(i.count_order_info=t.data.info,i.address_info=t.data.info.address_info?t.data.info.address_info:"",i.coupon_info=t.data.info.coupon_info?t.data.info.coupon_info:"",i.freight_coupon_info=t.data.info.freight_coupon_info?t.data.info.freight_coupon_info:"",i.order_goods_info=t.data.info.goods[0]):o.showToast({title:t.data.msg,icon:"none"})})},payEnd:function(){var i=this,t={user_id:this.globalData.user_info.userid,goods_num:this.orderInfo.shop_goods_num,goods_id:this.orderInfo.goods_id,address_id:this.address_info.id};this.use_user_money&&(t.use_user_money=this.use_user_money),1==this.disable_ticket?t.disable_ticket=this.disable_ticket:this.coupon_info?(t.disable_ticket=0,t.ticket_id=this.coupon_info.id):t.disable_ticket=0,1==this.disable_freight?t.disable_freight=this.disable_freight:this.freight_coupon_info?(t.disable_freight=0,t.user_freight_id=this.freight_coupon_info.id):t.disable_freight=0,this.input_content&&(t.remark=this.input_content),this.xm_config.add_market_order(t).then(function(t){1==t.data.status?null!=t.data.info&&null!=t.data.info.order_id&&(i.order_id=t.data.info.order_id,0==t.data.info.is_pay?(o.showToast({title:"使用余额支付成功",icon:"none"}),o.redirectTo({url:"../market-pay-success/market-pay-success?order_id="+i.order_id})):i.getWxParam()):o.showToast({title:t.data.msg,icon:"none"})})},getInputContent:function(o){this.input_content=o.detail.value},getWxParam:function(){var i=this,t={order_id:this.order_id,payment_code:"weixinapp"};this.xm_config.weixinxcx_add_order(t).then(function(t){1==t.data.status?null!=t.data.info&&null!=t.data.info.pay_info&&i.weixinappPay(t.data.info.pay_info):o.showToast({title:t.data.msg,icon:"none"})})},weixinxcxPay:function(i){var e=this;o.requestPayment({provider:"wxpay",timeStamp:i.timeStamp+"",nonceStr:i.nonceStr,package:i.package,signType:"MD5",paySign:i.sign,success:function(i){console.log(t(i," at pages\\market-pay\\market-pay.vue:329")),o.showToast({icon:"none",title:"支付成功"}),o.redirectTo({url:"../market-pay-success/market-pay-success?order_id="+e.order_id})},fail:function(i){console.log(t(i," at pages\\market-pay\\market-pay.vue:340")),o.showToast({icon:"none",title:"支付失败"})}})},weixinappPay:function(i){var e=this;o.requestPayment({provider:"wxpay",orderInfo:JSON.stringify({appid:i.appid,noncestr:i.noncestr,package:i.package,partnerid:i.partnerid,prepayid:i.prepayid,timestamp:i.timestamp+"",sign:i.sign}),success:function(i){console.log(t(i," at pages\\market-pay\\market-pay.vue:367")),o.showToast({icon:"none",title:"支付成功"}),o.redirectTo({url:"../market-pay-success/market-pay-success?order_id="+e.order_id})},fail:function(i){console.log(t(i," at pages\\market-pay\\market-pay.vue:378")),o.showToast({icon:"none",title:"支付失败"})}})},onJianClick:function(){1!=this.orderInfo.shop_goods_num?(this.shop_goods_num=--this.orderInfo.shop_goods_num,this.coupon_info="",this.calc_order_amount()):o.showToast({icon:"none",title:"数量不能少于1"})},onJiaClick:function(){null!=this.orderInfo?this.orderInfo.shop_goods_num!=this.orderInfo.kucun?(this.shop_goods_num=++this.orderInfo.shop_goods_num,this.coupon_info="",this.calc_order_amount()):o.showToast({icon:"none",title:"当前商品库存不足"}):o.showToast({icon:"none",title:"数据加载失败"})},onSelectAddressClick:function(){o.navigateTo({url:"../address/select-address-list/select-address-list?isCaidi=1"})},setAddressInfo:function(o){var i={id:o.id,region_id:o.region_id,city_id:o.city_id,region_name:o.region_name,city:o.city,consignee:o.consignee,address:o.address,phone_mob:o.phone_mob,default:o.default,auto_open:o.auto_open,is_beijing:o.is_beijing};this.address_info=i,this.calc_order_amount()},onSelectCouponClick:function(){var i={goods_id:this.orderInfo.goods_id,goods_num:this.orderInfo.shop_goods_num};o.navigateTo({url:"../select-coupon/select-coupon?couponInfo="+JSON.stringify(this.coupon_info)+"&goods_info="+JSON.stringify(i)+"&address_id="+this.address_info.id})},onSelectFreightCouponClick:function(){o.navigateTo({url:"../select-coupon-freight/select-coupon-freight?goodTotalPrice="+parseFloat(this.count_order_info.goods_amount).toFixed(2)+"&pt_goods="+this.orderInfo.pt_goods+"&freightInfo="+JSON.stringify(this.freight_coupon_info)})},setCunponBackData:function(o){o?(this.coupon_info=o,this.disable_ticket=0):(this.coupon_info="",this.disable_ticket=1),this.calc_order_amount()},setFreightBackData:function(o){o?(this.freight_coupon_info=o,this.disable_freight=0):(this.freight_coupon_info="",this.disable_freight=1),this.calc_order_amount()},onYeBoxClcik:function(){this.use_user_money=1==this.use_user_money?0:1,this.calc_order_amount()}}};i.default=e}).call(this,t("6e42")["default"],t("0de9")["default"])},"90a7":function(o,i,t){"use strict";var e=function(){var o=this,i=o.$createElement;o._self._c},n=[];t.d(i,"a",function(){return e}),t.d(i,"b",function(){return n})},c5cc:function(o,i,t){"use strict";t.r(i);var e=t("90a7"),n=t("0965");for(var s in n)"default"!==s&&function(o){t.d(i,o,function(){return n[o]})}(s);t("5171");var a=t("2877"),r=Object(a["a"])(n["default"],e["a"],e["b"],!1,null,null,null);i["default"]=r.exports}},[["1436","common/runtime","common/vendor"]]]);